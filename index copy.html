<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Html MetaTags (unchanged) -->
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=7">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="title" content="Minimalistic Wallpapers Gallery" />
  <meta name="description" content="Minimalistic, flat art, and colorful, digital nature wallpapers and an API for randomly selecting them." />
  <meta name="copyright" content="MicroResearch Corporation " />
  <meta name="keywords" content="Minimalistic Wallpapers Gallery, Minimalistic, Wallpapers, Gallery, Minimalistic Wallpapers ,Wallpapers Gallery" />
  <link href="./manifest.json" rel="manifest" />
  <link href="./src/icon.png" rel="data" />
  <link href="./src/icon.png" rel="apple-touch-icon" sizes="180x180" />
  <link href="./src/icon.png" rel="android-chrome-192x192" sizes="192x192" />
  <link href="./src/icon.png" rel="android-chrome-512x512" sizes="512x512" />
  <link href="./src/icon.png" rel="icon" sizes="32x32" />
  <link href="./src/icon.png" rel="icon" sizes="16x16" />
  <link href="./src/icon.png" rel="icon" />
  <script>navigator.serviceWorker?.register?.("src/sw.js").catch(()=>{});</script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="./src/style.css">
  <!-- <style>
    :root {
      --accent: #ffbcbc;
      --accent-txt: #721e1e;
      --body-bg: #1c1b1f;
      --body-txt: #e6e1e9;
      --container-bg: #211f26cc;
      --container-bg-sec: #2b2930cc;
      --outline: #938f99;
      --radius-xl: 10px;
      --radius-l: 12px;
      --glass-blur: 24px;
      --glass-alpha: 0.48;
    }
    body.light {
      --accent: #af3838;
      --accent-txt: #ffffff;
      --body-bg: #fef7ff;
      --body-txt: #1d1b20;
      --container-bg: #f3edf7cc;
      --container-bg-sec: #ece6f0cc;
      --outline: #79747e;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      margin: 0; padding: 0; font-family: "sans", sans-serif;
      background: var(--body-bg); color: var(--body-txt);
      transition: background 0.3s, color 0.3s; overflow-x: hidden;
    }

    /* Glassmorphism/translucent for cards and controls */
    .card, .header, .toolbar, .tabs-box, .popup, .m3-menu, .field, .lb-actions-desktop button, .card-meta {
      backdrop-filter: blur(var(--glass-blur));
      -webkit-backdrop-filter: blur(var(--glass-blur));
      background: linear-gradient(120deg, var(--container-bg) var(--glass-alpha), var(--container-bg-sec) 100%);
      box-shadow: 0 4px 40px 0 rgba(0,0,0,0.16);
      border: 1px solid rgba(255,255,255,0.07);
      /* Do not add border for .field, only for .card, .popup, etc */
    }
    .card { box-shadow: 0 4px 40px 0 rgba(28,27,31,0.13); }
    .popup {
      background: linear-gradient(125deg, var(--container-bg-sec) 80%, var(--body-bg) 100%);
      border: 2.5px solid var(--accent);
      backdrop-filter: blur(36px);
    }
    .tabs-box { box-shadow: none; }
    .toolbar, .header {
      box-shadow: 0 4px 24px 0 rgba(28,27,31,0.11);
      background: rgba(34,32,40,0.76)
    }

    /* progress */
    .progress-container{ position: fixed; top:0; z-index:1; width:100%; height:5px; background:transparent;}
    .progress-bar{ height:5px; background-image:repeating-linear-gradient(45deg,var(--accent),var(--accent-txt) 35px); width:0%; }

    #cur-dot,#cur-ring{ position: fixed; pointer-events: none; z-index: 10000; transform: translate(-50%,-50%); display:none; }
    #cur-dot{ width:6px; height:6px; border-radius:50%; background:var(--accent); box-shadow:0 0 6px rgba(0,0,0,.4); transition: background .12s, transform .08s, box-shadow .12s; }
    #cur-ring{ width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition: transform .12s ease-out, background .12s, color .12s; font-size:14px; color:var(--accent-txt); border:1px solid rgba(255,255,255,.06); background:transparent; }
    #cur-ring span{ display:block; pointer-events:none; transform:translateY(1px); opacity:.9; }

    @media (min-width: 1025px){
      #cur-dot,#cur-ring{ display:block; }
      *{ cursor: none !important; }
    }

    body.is-ptr #cur-ring{
      transform: translate(-50%,-50%) scale(1.45);
      mix-blend-mode: difference;
      background: var(--accent);
      color: var(--accent-txt);
      border-color: rgba(255,255,255,0.9);
      box-shadow: 0 4px 18px rgba(0,0,0,.45);
    }
    body.is-ptr #cur-dot{ background:var(--accent-txt); box-shadow:0 0 10px rgba(0,0,0,.5); transform: scale(1.25); }

    body.is-ptr #cur-ring::after{ content:""; position:absolute; top:-3px; left:4px; width:12px; height:12px; border-radius:50%; border:1px solid #fff; opacity:0; animation:dotted-circle-wave 1.1s infinite ease-out; pointer-events:none;}
    body.is-ptr #cur-ring::before{ content:""; position:absolute; top:-1px; left:6px; width:8px; height:8px; border-radius:50%; border:1px solid #fff; opacity:0; animation:dotted-circle-wave 1.1s infinite ease-out; animation-delay:0.3s;}
    @keyframes dotted-circle-wave{0%{opacity:.9; transform:scale(0.6);}100%{opacity:0; transform:scale(1.6);} }

    /* Gallery - make images extra responsive and cards wrap tightly */
    #gallery{ display:grid; gap:18px 12px; padding:0 4vw 40px; max-width:1600px; margin:0 auto; }
    .badge-rgb{ position:absolute; top:10px; left:10px; padding:4px 8px; font-size:10px; font-weight:bold; color:white; border-radius:4px; z-index:2; text-transform:uppercase; background:linear-gradient(45deg,#ff0000,#ff7300,#fffb00,#48ff00,#00ffd5,#002bff,#7a00ff,#ff00c8,#ff0000); background-size:400%; animation:rgb-glow 20s linear infinite; box-shadow:0 0 10px rgba(0,0,0,0.5); pointer-events:none; }
    @keyframes rgb-glow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    .card{ position:relative; overflow:hidden; background:var(--container-bg); border-radius:var(--radius-l); transition: transform .2s, box-shadow .18s; }
    .card:hover{ transform: translateY(-3px) scale(1.012); background:var(--container-bg-sec); box-shadow:0 8px 40px 0 rgba(164,100,140,0.095); }

    .img-hld{ aspect-ratio:16/9; background:#0007; position:relative; overflow:hidden; display:flex; align-items:center; }
    .img-hld img{ width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .67s; border-radius:8px 8px 0 0; }
    .img-hld img.loaded{ opacity:1; }

    .dots-btn{ position:absolute; top:10px; right:10px; background:rgba(0,0,0,.22); color:white; border-radius:50%; border:none; width:36px; height:36px; z-index:5; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 20px 0 rgba(50,1,20,0.13); }

    .card-meta{ padding:12px 10px 14px; margin-top:-2px; display:flex; flex-direction:column; gap:6px; }
    .meta-row-icons{ display:flex; align-items:center; font-size:12px; gap:10px; color:var(--outline); margin-top:3px;}
    .meta-row-icons .material-icons{ font-size:15px; opacity:0.87; vertical-align:middle;}
    .meta-row-icons span{ font-size:13px; }

    .name{ font-weight:600; font-size:18px; text-transform:lowercase; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; display:block; }
    .res{ font-size:12px; opacity:.63; margin-top:4px; font-family:monospace; letter-spacing:1px;}
    .meta-file{ font-size:13px; color:var(--outline); display:flex; align-items:center; gap:2px;}
    .meta-file .material-icons{ font-size:14px; opacity: 0.95; padding-right:2px; }

    /* Layouts */
    .l-single{ grid-template-columns:1fr; }
    .l-grid-2{ grid-template-columns:repeat(2,1fr); }
    .l-grid-3{ grid-template-columns:repeat(3,1fr); }
    @media (max-width: 720px){
      .l-single{ grid-template-columns:1fr !important;}
      .l-grid-2,.l-grid-3{ grid-template-columns:1fr !important;}
      #gallery { gap: 16px 4vw;}
    }

    .l-details .card, .l-compact .card{ display:flex; align-items:center; gap:12px; min-height:112px;}
    .l-details .img-hld, .l-compact .img-hld{ width:120px; height:78px; margin:10px 0 10px 10px; border-radius:8px; flex-shrink:0; }
    .l-details .card-meta{ display:flex; flex-direction:column; gap:6px; width:100%; }
    .l-details .meta-row{ display:flex; gap:12px; align-items:center; justify-content:space-between; }
    .l-details .meta-small{ font-size:13px; opacity:.7; display:flex; gap:12px; align-items:center; }

    .l-compact .card-meta{ display:grid; grid-template-columns: 1fr auto; width:100%; gap:4px 12px; align-items:center; }
    .l-compact .meta-left{ display:flex; flex-direction:column; gap:4px; overflow:hidden; }
    .l-compact .meta-right{ font-size:12px; opacity:.75; text-align:right; min-width:90px; }

    /* Details & Props */
    .popup{ border:3px double var(--accent); }

    /* Scrollbar */
    ::-webkit-scrollbar{ width:4px; height:4px; }
    ::-webkit-scrollbar-track{ background:transparent; }
    ::-webkit-scrollbar-thumb{ background:var(--accent); border-radius:4px; cursor:grab; }
    ::-webkit-scrollbar-thumb:active{ cursor:grabbing; }

    /* Responsive header and controls */
    @media (max-width:768px){ 
      .desktop-only{ display:none !important; } 
      .lb-arrow{ display:none; } 
      .popup .prop-grid{ grid-template-columns:1fr; } 
      .popup .prop-preview{ width:100%; height:180px; } 
      .header{ margin-top:2rem; gap:7px;}
      .toolbar{ flex-wrap:wrap;}
    }
    @media (max-width:480px){
      .header{ margin-top:3rem } 
      .header .meta .img-div{ display:none }
      .header .meta .social{ flex-direction:column; position:fixed; top:30%; left:0; z-index:10; }
      .card{ border-radius:16px; }
      .img-hld img, .img-hld{ border-radius:12px 12px 0 0; }
    }
    @media (min-width:769px){ .mobile-only{ display:none !important; } }
    /* Meta icon hints even on card details */
    .meta-hint{ display:inline-flex; align-items:center; font-size:12px; color:var(--outline); gap:2px;}
    .meta-hint .material-icons{ font-size:15px; opacity:.79; margin-right:1px;}
  </style> -->
  
  
  <!-- <style>
    /* 
   THEME: Minimalistic + Material Design 2 + Glassmorphism
   RULES: 10px & 16px radiuses only, Animated Text Badge, Side-panel Properties 
*/

:root {
  --accent: #ffbcbc;
  --accent-txt: #1c1b1f;
  --body-bg: #0f0f11;
  --body-txt: #e6e1e9;
  --glass-bg: rgba(30, 26, 36, 0.45);
  --glass-border: rgba(255, 255, 255, 0.08);
  --radius-s: 10px;
  --radius-l: 16px;
  --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

body.light {
  --accent: #af3838;
  --accent-txt: #ffffff;
  --body-bg: #f5f5f7;
  --body-txt: #1d1b20;
  --glass-bg: rgba(255, 255, 255, 0.5);
  --glass-border: rgba(0, 0, 0, 0.08);
}

* {
  box-sizing: border-box;
  cursor: none !important; /* Managed by custom cursor */
}

body {
  margin: 0;
  font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  background-color: var(--body-bg);
  color: var(--body-txt);
  line-height: 1.5;
}

/* --- Glassmorphism Core --- */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border);
}

/* --- Header & Search (Not Fixed) --- */
.header {
  padding: 40px 5% 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.field {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-s);
  padding: 12px 16px;
  color: var(--body-txt);
  transition: all 0.2s ease;
  outline: none;
}

.field:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255, 188, 188, 0.2);
}

/* --- Animated Text Badge --- */
.badge-rgb {
  position: absolute;
  top: 12px;
  left: 12px;
  font-weight: 800;
  font-size: 11px;
  letter-spacing: 1px;
  z-index: 10;
  background: linear-gradient(to right, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
  background-size: 400% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rgb-text 5s linear infinite;
  background-color: rgba(0,0,0,0.3); /* dark backing for visibility */
  padding: 2px 6px;
  border-radius: 4px;
}

@keyframes rgb-text {
  to { background-position: 400% center; }
}

/* --- Custom Cursor --- */
#cur-dot {
  width: 8px;
  height: 8px;
  background: var(--accent);
  border-radius: 50%;
  position: fixed;
  z-index: 10001;
  pointer-events: none;
}

#cur-ring {
  width: 40px;
  height: 40px;
  border: 1.5px solid var(--accent);
  border-radius: 50%;
  position: fixed;
  z-index: 10000;
  pointer-events: none;
  transition: width 0.3s, height 0.3s, background 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

#cur-ring span { font-size: 14px; opacity: 0; }

body.is-ptr #cur-ring {
  width: 60px;
  height: 60px;
  background: rgba(255,255,255,0.1);
  mix-blend-mode: difference;
  border-color: #fff;
}

body.is-ptr #cur-ring span { opacity: 1; color: #fff; }

/* --- Gallery Layouts --- */
#gallery {
  display: grid;
  padding: 20px 5%;
  gap: 20px;
}

.card {
  position: relative;
  background: var(--glass-bg);
  border-radius: var(--radius-l);
  overflow: hidden;
  border: 1px solid var(--glass-border);
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow);
}

.img-hld {
  width: 100%;
  aspect-ratio: 16/9;
  background: #000;
  overflow: hidden;
}

.img-hld img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity 0.5s;
}

.card-meta { padding: 16px; }
.card-meta .name { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }

/* --- Windows Explorer Detail Layout --- */
.l-details {
  display: flex !important;
  flex-direction: column;
  gap: 8px !important;
}

.l-details .card {
  display: grid;
  grid-template-columns: 80px 2fr 1fr 1fr 1fr;
  align-items: center;
  padding: 8px 16px;
  border-radius: var(--radius-s);
}

.l-details .img-hld {
  width: 60px;
  height: 40px;
  border-radius: 4px;
}

.l-details .card-meta {
  display: contents; /* Allows meta items to align with grid header */
}

/* --- Compact View (2-column Grid within Details) --- */
.l-compact {
  grid-template-columns: repeat(2, 1fr) !important;
}

.l-compact .card {
  display: flex;
  align-items: center;
  padding: 10px;
  gap: 12px;
}

.l-compact .img-hld {
  width: 100px;
  height: 60px;
  flex-shrink: 0;
  border-radius: var(--radius-s);
}

/* --- Metadata Icons & Alignment --- */
.meta-row-icons {
  display: flex;
  gap: 15px;
  color: var(--body-txt);
  opacity: 0.7;
  font-size: 0.85rem;
  align-items: center;
}

.meta-row-icons .material-icons {
  font-size: 16px !important; /* Fixed size as requested */
  margin-right: 4px;
  vertical-align: middle;
}

/* --- Properties Panel (Desktop Side-Panel / Mobile Popup) --- */
#prop-popup {
  position: fixed;
  z-index: 2000;
  background: var(--glass-bg);
  backdrop-filter: blur(25px);
  border-left: 1px solid var(--glass-border);
  padding: 30px;
  display: none;
  overflow-y: auto;
}

/* Desktop Logic */
@media (min-width: 1025px) {
  #prop-popup {
    top: 0;
    right: 0;
    width: 420px;
    height: 100vh;
    border-radius: var(--radius-l) 0 0 var(--radius-l);
    box-shadow: -10px 0 30px rgba(0,0,0,0.2);
    animation: slideInRight 0.4s ease forwards;
  }
}

/* Mobile Logic */
@media (max-width: 1024px) {
  #prop-popup {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    max-height: 80vh;
    border-radius: var(--radius-l);
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow);
  }
}

@keyframes slideInRight {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

/* Property Panel Content Fixes */
.prop-grid {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.prop-preview img {
  width: 100%;
  border-radius: var(--radius-s);
  border: 1px solid var(--glass-border);
}

.prop-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.prop-label { font-weight: 600; font-size: 0.9rem; opacity: 0.6; }
.prop-val { font-family: monospace; font-size: 0.9rem; word-break: break-all; text-align: right; margin-left: 10px;}

/* --- Tabs & Footer --- */
.tabs-box {
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 20px;
}

.tab {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-s);
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
}

.tab.active {
  background: var(--accent);
  color: var(--accent-txt);
}

/* Lightbox Enhancements */
.lightbox {
  background: rgba(0,0,0,0.95);
  backdrop-filter: blur(10px);
}

#lb-img {
  max-width: 90%;
  max-height: 80vh;
  border-radius: var(--radius-l);
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

/* Utility: Responsive Grids */
@media (min-width: 1200px) { .l-grid-3 { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 768px) {
  #gallery { grid-template-columns: 1fr !important; }
  .l-compact { grid-template-columns: 1fr !important; }
  .header { padding-top: 60px; }
  .badge-rgb { font-size: 9px; }
}

/* Fix Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--body-bg); }
::-webkit-scrollbar-thumb { 
  background: var(--glass-border); 
  border-radius: 10px; 
}
::-webkit-scrollbar-thumb:hover { background: var(--accent); }
  </style> -->
  
  <style>
    /* 
   THEME: Minimalistic + Material Design 2 + Glassmorphism
   RULES: 10px & 16px radiuses only, Animated Text Badge, Side-panel Properties 
*/

:root {
  --accent: #ffbcbc;
  --accent-txt: #1c1b1f;
  --body-bg: #0f0f11;
  --body-txt: #e6e1e9;
  --glass-bg: rgba(30, 26, 36, 0.45);
  --glass-border: rgba(255, 255, 255, 0.08);
  --radius-s: 10px;
  --radius-l: 16px;
  --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

body.light {
  --accent: #af3838;
  --accent-txt: #ffffff;
  --body-bg: #f5f5f7;
  --body-txt: #1d1b20;
  --glass-bg: rgba(255, 255, 255, 0.5);
  --glass-border: rgba(0, 0, 0, 0.08);
}

* {
  box-sizing: border-box;
  cursor: none !important; /* Managed by custom cursor */
}

body {
  margin: 0;
  font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  background-color: var(--body-bg);
  color: var(--body-txt);
  line-height: 1.5;
}

/* --- Glassmorphism Core --- */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--glass-border);
}

/* --- Header & Search (Not Fixed) --- */
.header {
  padding: 40px 5% 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.field {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: var(--radius-s);
  padding: 12px 16px;
  color: var(--body-txt);
  transition: all 0.2s ease;
  outline: none;
}

.field:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(255, 188, 188, 0.2);
}

/* --- Animated Text Badge --- */
.badge-rgb {
  position: absolute;
  top: 12px;
  left: 12px;
  font-weight: 800;
  font-size: 11px;
  letter-spacing: 1px;
  z-index: 10;
  background: linear-gradient(to right, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
  background-size: 400% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: rgb-text 5s linear infinite;
  background-color: rgba(0,0,0,0.3); /* dark backing for visibility */
  padding: 2px 6px;
  border-radius: 4px;
}

@keyframes rgb-text {
  to { background-position: 400% center; }
}

/* --- Custom Cursor --- */
#cur-dot {
  width: 8px;
  height: 8px;
  background: var(--accent);
  border-radius: 50%;
  position: fixed;
  z-index: 10001;
  pointer-events: none;
}

#cur-ring {
  width: 40px;
  height: 40px;
  border: 1.5px solid var(--accent);
  border-radius: 50%;
  position: fixed;
  z-index: 10000;
  pointer-events: none;
  transition: width 0.3s, height 0.3s, background 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

#cur-ring span { font-size: 14px; opacity: 0; }

body.is-ptr #cur-ring {
  width: 60px;
  height: 60px;
  background: rgba(255,255,255,0.1);
  mix-blend-mode: difference;
  border-color: #fff;
}

body.is-ptr #cur-ring span { opacity: 1; color: #fff; }

/* --- Gallery Layouts --- */
#gallery {
  display: grid;
  padding: 20px 5%;
  gap: 20px;
}

.card {
  position: relative;
  background: var(--glass-bg);
  border-radius: var(--radius-l);
  overflow: hidden;
  border: 1px solid var(--glass-border);
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow);
}

.img-hld {
  width: 100%;
  aspect-ratio: 16/9;
  background: #000;
  overflow: hidden;
}

.img-hld img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity 0.5s;
}

.card-meta { padding: 16px; }
.card-meta .name { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }

/* --- Windows Explorer Detail Layout --- */
.l-details {
  display: flex !important;
  flex-direction: column;
  gap: 8px !important;
}

.l-details .card {
  display: grid;
  grid-template-columns: 80px 2fr 1fr 1fr 1fr;
  align-items: center;
  padding: 8px 16px;
  border-radius: var(--radius-s);
}

.l-details .img-hld {
  width: 60px;
  height: 40px;
  border-radius: 4px;
}

.l-details .card-meta {
  display: contents; /* Allows meta items to align with grid header */
}

/* --- Compact View (2-column Grid within Details) --- */
.l-compact {
  grid-template-columns: repeat(2, 1fr) !important;
}

.l-compact .card {
  display: flex;
  align-items: center;
  padding: 10px;
  gap: 12px;
}

.l-compact .img-hld {
  width: 100px;
  height: 60px;
  flex-shrink: 0;
  border-radius: var(--radius-s);
}

/* --- Metadata Icons & Alignment --- */
.meta-row-icons {
  display: flex;
  gap: 15px;
  color: var(--body-txt);
  opacity: 0.7;
  font-size: 0.85rem;
  align-items: center;
}

.meta-row-icons .material-icons {
  font-size: 16px !important; /* Fixed size as requested */
  margin-right: 4px;
  vertical-align: middle;
}

/* --- Properties Panel (Desktop Side-Panel / Mobile Popup) --- */
#prop-popup {
  position: fixed;
  z-index: 2000;
  background: var(--glass-bg);
  backdrop-filter: blur(25px);
  border-left: 1px solid var(--glass-border);
  padding: 30px;
  display: none;
  overflow-y: auto;
}

/* Desktop Logic */
@media (min-width: 1025px) {
  #prop-popup {
    top: 0;
    right: 0;
    width: 420px;
    height: 100vh;
    border-radius: var(--radius-l) 0 0 var(--radius-l);
    box-shadow: -10px 0 30px rgba(0,0,0,0.2);
    animation: slideInRight 0.4s ease forwards;
  }
}

/* Mobile Logic */
@media (max-width: 1024px) {
  #prop-popup {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    max-height: 80vh;
    border-radius: var(--radius-l);
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow);
  }
}

@keyframes slideInRight {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

/* Property Panel Content Fixes */
.prop-grid {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.prop-preview img {
  width: 100%;
  border-radius: var(--radius-s);
  border: 1px solid var(--glass-border);
}

.prop-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.prop-label { font-weight: 600; font-size: 0.9rem; opacity: 0.6; }
.prop-val { font-family: monospace; font-size: 0.9rem; word-break: break-all; text-align: right; margin-left: 10px;}

/* --- Tabs & Footer --- */
.tabs-box {
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 20px;
}

.tab {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-s);
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
}

.tab.active {
  background: var(--accent);
  color: var(--accent-txt);
}

/* Lightbox Enhancements */
.lightbox {
  background: rgba(0,0,0,0.95);
  backdrop-filter: blur(10px);
}

#lb-img {
  max-width: 90%;
  max-height: 80vh;
  border-radius: var(--radius-l);
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}

/* Utility: Responsive Grids */
@media (min-width: 1200px) { .l-grid-3 { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 768px) {
  #gallery { grid-template-columns: 1fr !important; }
  .l-compact { grid-template-columns: 1fr !important; }
  .header { padding-top: 60px; }
  .badge-rgb { font-size: 9px; }
}

/* Fix Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--body-bg); }
::-webkit-scrollbar-thumb { 
  background: var(--glass-border); 
  border-radius: 10px; 
}
::-webkit-scrollbar-thumb:hover { background: var(--accent); }
  </style>
  
  
  <title>Minimalistic Wallpapers Gallery</title>
</head>
<body oncontextmenu="return false;">
  <div class="progress-container"><div class="progress-bar" id="myBar"></div></div>
  <a href="https://github.com/MicroResearch-Corporation/Minimalistic-Wallpapers-Gallery" title="Give a Star" class="field rate"><span class="material-icons">star_rate</span></a>

  <div id="cur-dot"></div>
  <div id="cur-ring"><span class="material-icons">pan_tool_alt</span></div>

  <header class="header">
    <div class="meta">
      <div class="img-div"><img alt="" src="./src/icon.png"></div>
      <div class="social">
        <a class="link" href="https://www.facebook.com/mramzanch01" target="_blank"><img src="./src/FB.png" title="Facebook">Facebook</a>
        <a class="link" href="https://www.instagram.com/rm4814591" target="_blank"><img src="./src/instagram.png" title="Instagram">Facebook</a>
        <a class="link" href="https://pk.linkedin.com/in/mramzanch" target="_blank"><img src="./src/LnK.png" title="LinkedIn">LinkedIn</a>
        <a class="link" href="https://www.x.com/rm4814591" target="_blank"><img src="./src/X.png" title="twitter">X</a>
      </div>
    </div>
    <input class="field searchbar" type="text" id="search-in" placeholder="Search gallery repository...">
    <div class="toolbar">
      <div class="select">
        <select id="sort-by" class="field sort-by">
          <option value="name">Name</option>
          <option value="date">Date</option>
          <option value="rawSize">File Size</option>
          <option value="type">File Type</option>
          <option value="folder">Folder</option>
          <option value="resArea">Resolution</option>
        </select>
      </div>
      <div class="sort">
        <button id="sort-order" class="field sort-order"><span class="material-icons">sort</span></button>
      </div>
      <div class="layout">
        <select id="layout-sel" class="field layout-sel"></select>
      </div>
      <div class="theme-chn">
        <button id="theme-tog" class="field theme-tog"><span class="material-icons">brightness_4</span></button>
      </div>
    </div>
  </header>

  <div id="tabs" class="tabs-box"></div>
  <div id="gallery"></div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <div class="lb-ctrl-mobile mobile-only">
      <button class="field" onclick="openMenu(event, curIdx, 'lb')"><span class="material-icons">more_vert</span></button>
      <button class="field" onclick="closeLB()"><span class="material-icons">close</span></button>
    </div>
    <button class="field lb-close-desktop desktop-only" onclick="closeLB()"><span class="material-icons">close</span></button>
    <div style="position:relative; width:100%; display:flex; justify-content:center; align-items:center;">
      <button class="lb-arrow lb-p" onclick="nav(-1)"><span class="material-icons">arrow_back_ios</span></button>
      <img id="lb-img" src="">
      <button class="lb-arrow lb-n" onclick="nav(1)"><span class="material-icons">arrow_forward_ios</span></button>
    </div>
    <div class="lb-actions-desktop desktop-only" id="lb-actions-dk"></div>
  </div>

  <div id="m3-menu" class="m3-menu"></div>

  <div id="prop-popup" class="popup" aria-hidden="true">
    <h3 class="popup-h3">Properties</h3>
    <div id="prop-body"></div>
    <button onclick="document.getElementById('prop-popup').style.display='none'" class="field"><span class="material-icons">cancel</span></button>
  </div>

  <hr />
  <footer style="width:-webkit-fill-available; text-align:center;">
    © 2025 <a href="https:github.com/MicroResearch-Corporation/" style="text-decoration:none; color:var(--accent); ">MicroResearch Corporation®</a>. All Rights Reserved.<br><br>
    Made with ♥ by <a href="https://mramzanch.blogspot.com/" style="text-decoration:none; color:var(--accent); "> M Ramzan Ch</a>
  </footer>

  <a href="https://github.com/Pro-Bandey" class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:var(--accent);color:var(--accent-txt);border:0;position:absolute;top:5px;right:5px" aria-hidden="true">
      <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
      <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path>
      <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
  </a>
  <script>
    // Preload Material icons for speed; Preconnect googleapis/fonts
    (() => {
      const l = document.createElement('link'); l.rel = 'preconnect'; l.href = 'https://fonts.googleapis.com'; document.head.appendChild(l);
      const l2 = document.createElement('link'); l2.rel = 'preconnect'; l2.href = 'https://fonts.gstatic.com'; l2.crossOrigin = 'anonymous'; document.head.appendChild(l2);
    })();
  </script>
  <script>
    /* CONFIG and data loader (enhanced to preserve original JSON inside each item) */
    const CONFIG = {
      json: "https://raw.githubusercontent.com/Pro-Bandey/minimalistic-wallpapers/output/images-meta.json",
      imageBase: "https://raw.githubusercontent.com/Pro-Bandey/minimalistic-wallpapers/main/",
      limit: 30,
      NEW_DAYS: 14
    };

    let allData = [], filtered = [], curIdx = 0, page = 0;
    const state = {
      theme: localStorage.getItem("theme") || "dark",
      layout: localStorage.getItem("layout") || (window.innerWidth < 768 ? "l-grid-2" : "l-grid-3"),
      sort: localStorage.getItem("sort") || "name",
      order: localStorage.getItem("order") || "asc"
    };

    async function start() {
      if (state.theme === "light") document.body.classList.add("light");
      document.getElementById("sort-by").value = state.sort;

      const lSel = document.getElementById("layout-sel");
      const layouts = window.innerWidth < 768
        ? [{ id: "l-grid-2", n: "Grid" }, { id: "l-single", n: "Single" }, { id: "l-details", n: "Details" }]
        : [{ id: "l-grid-3", n: "Grid 3x" }, { id: "l-grid-2", n: "Grid 2x" }, { id: "l-single", n: "Single" }, { id: "l-details", n: "Details" }, { id: "l-compact", n: "Compact" }];

      layouts.forEach((l) => {
        const o = document.createElement("option"); o.value = l.id; o.textContent = l.n;
        if (l.id === state.layout) o.selected = true;
        lSel.appendChild(o);
      });

      if (window.innerWidth > 768) {
        const d = document.getElementById("cur-dot"), r = document.getElementById("cur-ring");
        document.addEventListener("mousemove", (e) => {
          d.style.left = e.clientX + "px"; d.style.top = e.clientY + "px";
          r.style.left = e.clientX + "px"; r.style.top = e.clientY + "px";
          document.body.classList.toggle("is-ptr", !!e.target.closest("a, button, input, select, .card, .tab, .dots-btn, .field"));
          // change ring icon when over interactive
          const span = r.querySelector("span");
          if (document.body.classList.contains("is-ptr")) span.textContent = "pointer"; else span.textContent = "pan_tool_alt";
        });
      }

      await fetchFiles();
      const q = new URLSearchParams(window.location.search).get("q");
      if (q) document.getElementById("search-in").value = q;
      apply();
    }

    async function fetchFiles() {
      try {
        const res = await fetch(CONFIG.json, { cache: "no-store" });
        if (!res.ok) throw new Error("JSON fetch failed");
        const data = await res.json();
        const now = Date.now();
        const NEW_MS = CONFIG.NEW_DAYS * 86400000;

        allData = data.images.map(img => {
          const added = new Date(img.dates?.added || img.dates?.updated || Date.now()).getTime();
          const kb = typeof img.kb === "number" ? img.kb : (img.sizeBytes ? img.sizeBytes / 1024 : 0);
          return {
            raw: img,                       // preserve original object for advanced inspection
            id: img.id || "",
            name: img.name || img.src.split("/").pop(),
            url: CONFIG.imageBase + img.src,
            folder: img.folder || "root",
            path: img.src,
            ext: img.ext || (img.src.split(".").pop() || ""),
            type: (img.ext || (img.src.split(".").pop() || "")).toUpperCase(),
            kb: kb,
            rawSize: Math.round(kb * 1024),
            sizeStr: `${kb.toFixed(2)} KB`,
            res: "...",
            resArea: 0,
            dates: img.dates || {},
            hash: img.hash || "",
            tags: img.tags || [],
            date: added,
            isNew: now - added <= NEW_MS
          };
        });
      } catch (e) {
        console.error("Image JSON error:", e);
        alert("Failed to load images metadata.");
      }
    }

    function apply() {
      const q = document.getElementById("search-in").value.toLowerCase();
      filtered = allData.filter((i) => i.name.toLowerCase().includes(q));
      const s = document.getElementById("sort-by").value;
      filtered.sort((a, b) => {
        if (s === "date") return state.order === "asc" ? a.date - b.date : b.date - a.date;
        const vA = a[s], vB = b[s];
        if (typeof vA === "string") return state.order === "asc" ? vA.localeCompare(vB) : vB.localeCompare(vA);
        return state.order === "asc" ? vA - vB : vB - vA;
      });
      page = 0; render();
    }

    function render() {
      const gal = document.getElementById("gallery");
      const lay = document.getElementById("layout-sel").value;
      gal.className = lay;
      gal.innerHTML = "";
      const startIdx = page * CONFIG.limit;
      const items = filtered.slice(startIdx, startIdx + CONFIG.limit);

      items.forEach((img, i) => {
        const gIdx = startIdx + i;
        const card = document.createElement("div");
        card.className = "card";
        card.onclick = () => openLB(gIdx);
        card.oncontextmenu = (e) => openMenu(e, gIdx, "card");

        let timer;
        card.ontouchstart = (e) => (timer = setTimeout(() => openMenu(e, gIdx, "card"), 700));
        card.ontouchend = () => clearTimeout(timer);

        // icons for meta rows
        const folderIcon = `<span class="material-icons" title="Folder">folder</span>`;
        const extIcon = `<span class="material-icons" style="vertical-align:middle;" title="File Type">image</span>`;
        const sizeIcon = `<span class="material-icons" title="Size">sd_storage</span>`;
        card.innerHTML = `
          <div class="img-hld">
            ${img.isNew ? '<div class="badge-rgb">NEW</div>' : ''}
            <img src="${img.url}" loading="lazy" decoding="async" onload="setRes(this, ${gIdx})" width="100%" height="auto">
          </div>
          <button class="dots-btn" onclick="openMenu(event, ${gIdx}, 'card')">
            <span class="material-icons">more_vert</span>
          </button>
          <div class="card-meta">
            <div class="name">${img.name}</div>
            <div class="res" id="r-${gIdx}">${img.res}</div>
            <div class="meta-row-icons">
              <span class="meta-file" title="File Size">${sizeIcon} ${img.sizeStr}</span>
              <span class="meta-file" title="Extension">${extIcon} ${img.type}</span>
              <span class="meta-file" title="Folder">${folderIcon} ${img.folder}</span>
            </div>
          </div>
        `;
        gal.appendChild(card);
      });
      renderTabs();
    }

    function setRes(imgEl, idx) {
      const w = imgEl.naturalWidth, h = imgEl.naturalHeight;
      const r = `${w}x${h}`;
      // ensure we update the underlying items' res - there are two arrays (allData & filtered)
      const item = filtered[idx];
      if (item) { item.res = r; item.resArea = w * h; }
      const id = item?.id;
      if (id) {
        const a = allData.find(x => x.id === id);
        if (a) { a.res = r; a.resArea = w * h; }
      }
      imgEl.classList.add("loaded");
      const el = document.getElementById(`r-${idx}`);
      if (el) el.innerText = r;
    }

    function renderTabs() {
      const t = document.getElementById("tabs");
      t.innerHTML = "";
      const pages = Math.ceil(filtered.length / CONFIG.limit);
      if (pages <= 1) return;
      for (let i = 0; i < pages; i++) {
        const b = document.createElement("button");
        b.className = `tab ${i === page ? "active" : ""}`;
        b.innerText = i + 1;
        b.onclick = () => { page = i; render(); window.scrollTo(0,0); };
        t.appendChild(b);
      }
    }

    const Actions = {
      tab: (i) => window.open(filtered[i].url, "_blank"),
      dl: async (i) => {
        const img = filtered[i];
        const blob = await fetch(img.url).then((r) => r.blob());
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = img.name;
        a.click();
      },
      copyI: async (i) => {
        const res = await fetch(filtered[i].url);
        const blob = await res.blob();
        try {
          await navigator.clipboard.write([ new ClipboardItem({ [blob.type]: blob }) ]);
          alert("Image copied to clipboard!");
        } catch (e) {
          alert("Copy failed: Browser restriction.");
        }
      },
      shareI: async (i) => {
        const b = await fetch(filtered[i].url).then((r) => r.blob());
        const f = new File([b], filtered[i].name, { type: b.type });
        if (navigator.canShare && navigator.canShare({ files: [f] })) navigator.share({ files: [f] });
      },
      copyU: (i) => { navigator.clipboard.writeText(filtered[i].url); alert("Link Copied!"); },
      shareU: (i) => navigator.share?.({ title: filtered[i].name, url: filtered[i].url })?.catch(()=>{}),
      props: (i) => {
        const img = filtered[i] || {};
        const raw = img.raw || {};
        const folderIcon = `<span class="material-icons" title="Folder" style="vertical-align:middle; font-size:15px;">folder</span>`;
        // Prepare date strings
        const added = (img.dates?.added ? new Date(img.dates.added) : (img.date ? new Date(img.date) : null));
        const updated = (img.dates?.updated ? new Date(img.dates.updated) : null);
        const addedStr = added ? added.toLocaleString() : "—";
        const updatedStr = updated ? updated.toLocaleString() : (img.dates?.updated ? img.dates.updated : "—");

        const previewHtml = `<div class="prop-preview"><img src="${img.url}" onload="this.classList.add('loaded')"></div>`;

        const list = [
          { l: "Filename", v: img.name || "—" },
          { l: "ID", v: img.id || "—" },
          { l: "Resolution", v: img.res || "—" },
          { l: "File Size", v: img.sizeStr + ` (${(img.rawSize || 0).toLocaleString()} bytes)` },
          { l: "Format", v: img.type || (img.ext || "—").toUpperCase() },
          { l: "Folder", v: `${folderIcon} ${img.folder || "—"}` },
          { l: "Repo Path", v: img.path || "—" },
          { l: "Added", v: addedStr },
          { l: "Updated", v: updatedStr },
          { l: "Hash", v: img.hash || "—" },
          { l: "Tags", v: (Array.isArray(img.tags) ? img.tags.join(", ") : (img.tags || "—")) }
        ];

        const listHtml = list.map(p => `
          <div class="prop-item">
            <div style="display:flex; gap:8px; align-items:center;">
              <span class="prop-label">${p.l}</span>
              <span class="prop-val" id="pv-${p.l.replace(/\s+/g,'-')}">${p.v}</span>
            </div>
            <div style="display:flex; gap:6px; align-items:center;">
              <button class="copy-btn" onclick="copyProp('${escapeForCopy(p.v)}')">Copy</button>
            </div>
          </div>`).join("");

        // Raw JSON preview collapsible
        const rawJson = `<details><summary style="cursor:pointer">Show raw JSON</summary><pre>${escapeHtml(JSON.stringify(raw, null, 2))}</pre></details>`;

        const html = `
          <div class="prop-grid">
            ${previewHtml}
            <div class="prop-list">
              ${listHtml}
              ${rawJson}
            </div>
          </div>
        `;

        document.getElementById("prop-body").innerHTML = html;
        document.getElementById("prop-popup").style.display = "block";
        document.getElementById("prop-popup").setAttribute("aria-hidden", "false");
      }
    };

    function escapeHtml(s){ return String(s).replace(/[&<>]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;'})[c]); }
    function escapeForCopy(s){ return (s === undefined || s === null) ? "" : String(s).replace(/'/g,"\\'").replace(/"/g,'\\"'); }

    function copyProp(text){
      try{
        navigator.clipboard.writeText(text);
        alert("Copied: " + (text.length > 120 ? text.slice(0,120) + "..." : text));
      }catch(e){
        alert("Copy failed: " + (e.message||e));
      }
    }

    function hideMenus(){ document.getElementById("m3-menu").style.display = "none"; }

    function openMenu(e, idx, ctx){
      if (e){ e.preventDefault(); e.stopPropagation(); }
      curIdx = idx;
      const menu = document.getElementById("m3-menu");
      const list = ctx === "lb" ? [
        { k: "tab", n: "Open Tab", i: "open_in_new" },
        { k: "dl", n: "Download", i: "file_download" },
        { k: "copyI", n: "Copy Image", i: "perm_media" },
        { k: "shareI", n: "Share File", i: "image" },
        { k: "copyU", n: "Copy Link", i: "link" },
        { k: "shareU", n: "Share Link", i: "share" },
        { k: "props", n: "Details", i: "info" }
      ] : [
        { k: "lb", n: "Open", i: "visibility" },
        { k: "shareU", n: "Quick Share", i: "share" },
        { k: "props", n: "Properties", i: "info" }
      ];

      menu.innerHTML = list.map(it => `
        <button onclick="exec('${it.k}', ${idx})">
          <span class="material-icons" style="font-size:20px">${it.i}</span>
          <span>${it.n}</span>
        </button>
      `).join("");
      menu.style.display = "block";

      if (e && e.clientX){
        const x = Math.min(e.clientX, window.innerWidth - 260);
        const y = Math.min(e.clientY, window.innerHeight - list.length * 50);
        menu.style.left = x + "px"; menu.style.top = y + "px"; menu.style.transform = "none";
      } else {
        menu.style.left = "50%"; menu.style.top = "50%"; menu.style.transform = "translate(-50%,-50%)";
      }
    }

    function exec(k,i){
      hideMenus();
      if (k === "lb") openLB(i);
      else if (Actions[k]) Actions[k](i);
    }

    function openLB(i){
      curIdx = i;
      const img = filtered[i];
      document.getElementById("lb-img").src = img.url;
      document.getElementById("lightbox").style.display = "flex";

      if (window.innerWidth > 768){
        const area = document.getElementById("lb-actions-dk");
        const config = [
          { k: "tab", n: "Tab", i: "open_in_new" },
          { k: "dl", n: "Download", i: "file_download" },
          { k: "copyI", n: "Copy", i: "perm_media" },
          { k: "shareI", n: "Share", i: "image" },
          { k: "copyU", n: "Link", i: "link" },
          { k: "shareU", n: "Share Link", i: "share" },
          { k: "props", n: "Properties", i: "info" }
        ];
        area.innerHTML = config.map(it => `
          <button class="field" onclick="Actions.${it.k}(${i})" style="display:inline-flex; align-items:center; gap:8px;">
            <span class="material-icons" style="font-size:18px">${it.i}</span> ${it.n}
          </button>
        `).join("");
      }
    }

    function closeLB(){ document.getElementById("lightbox").style.display = "none"; }
    function nav(d){ curIdx = (curIdx + d + filtered.length) % filtered.length; openLB(curIdx); }

    // Global Listeners & bindings
    document.getElementById("theme-tog").onclick = () => {
      document.body.classList.toggle("light");
      localStorage.setItem("theme", document.body.classList.contains("light") ? "light" : "dark");
    };
    document.getElementById("layout-sel").onchange = (e) => { localStorage.setItem("layout", e.target.value); render(); };
    document.getElementById("sort-by").onchange = (e) => { state.sort = e.target.value; localStorage.setItem("sort", e.target.value); apply(); };
    document.getElementById("sort-order").onclick = () => { state.order = state.order === "asc" ? "desc" : "asc"; localStorage.setItem("order", state.order); apply(); };
    document.getElementById("search-in").oninput = (e) => { const url = new URL(window.location); if (e.target.value) url.searchParams.set("q", e.target.value); else url.searchParams.delete("q"); window.history.replaceState({}, "", url); apply(); };

    window.onscroll = hideMenus;
    window.addEventListener("click", (e) => { if (!e.target.closest(".m3-menu") && !e.target.closest(".dots-btn")) hideMenus(); });

    // Touch gestures
    if ("ontouchstart" in window) {
      let ts = 0;
      document.getElementById("lightbox").ontouchstart = (e) => (ts = e.touches[0].clientX);
      document.getElementById("lightbox").ontouchend = (e) => {
        const te = e.changedTouches[0].clientX;
        if (ts - te > 70) nav(1);
        if (te - ts > 70) nav(-1);
      };
    }

    start();
  </script>
  <script>
    window.onscroll = function () { myFunction() };
    function myFunction() {
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = (winScroll / height) * 100;
      document.getElementById("myBar").style.width = scrolled + "%";
    }
  </script>
</body>
</html>